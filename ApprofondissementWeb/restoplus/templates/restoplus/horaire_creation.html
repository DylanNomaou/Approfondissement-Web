{% extends 'restoplus/base.html' %}
{% load static %}


{% block content %}
<section class="page-creation-horaire">
    <div class="horaire-container">
        <!--En tete-->
        <div class="horaire-header">
            <div class="header-content">
                <!--Titre-->
                <h1>
                    <i class="fas fa-calendar-alt"></i>
                    Création des horaires
                </h1>

                <!-- Action Buttons -->
                <div class="header-actions">

                    <!--Sélecteur de semaine-->
                    <div class="week-selector">
                        <!--Semaine Précédente-->
                        <button class="btn-week" id="prev-week-btn"><i class="fas fa-chevron-left"></i></button>

                        <!--Semaine actuelle-->
                        <span class="current-week" id="current-week-display">
                            {% if week_days and week_days.0.date_formatted and week_days.6.date_formatted %}
                            {{ week_days.0.date_formatted }} - {{ week_days.6.date_formatted }}
                            {% elif week_days and week_days.0.date_short and week_days.6.date_short %}
                            {{ week_days.0.date_short }}/2025 - {{ week_days.6.date_short }}/2025
                            {% else %}
                            Semaine actuelle
                            {% endif %}
                        </span>

                        <!--Semaine Suivante-->
                        <button class="btn-week" id="next-week-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <!--Fin du sélecteur de semaine-->

                    <!--Actions de publication-->
                    <div class="action-buttons">

                        <!--Sauvgarder l'horaire-->
                        <button class="btn btn-secondary">
                            <i class="fas fa-save"></i>
                            Enregistrer le brouillon
                        </button>

                        <!--publier les horaires-->
                        <button class="btn btn-primary">
                            <i class="fas fa-check"></i>
                            Publier les horaires
                        </button>

                    </div>
                    <!--Fin des actions de publication-->

                </div>
            </div>
        </div>

        <!--Outils de planificaition-->
        <div class="planning-tools">
            <div class="tools-section">
                <h3><i class="fas fa-tools"></i> Outils de planification</h3>
                <div class="tools-grid">
                    <!--Button pour Générer un horaire automatique-->
                    <button class="tool-button"><i class="fas fa-magic"></i> <span>Générer un horaire</span> </button>
                    <!--Button pour Copier l'horaire de la semaine précédente-->
                    <button class="tool-button"><i class="fas fa-copy"></i> <span>Copier sem.précédente</span> </button>
                    <!--Button pour Effacer tout l'horaire-->
                    <button class="tool-button"><i class="fas fa-eraser"></i> <span>Tout effacer</span> </button>
                </div>
            </div>

            <!--Statistiques rapides-->
            <div class="quick-stats">
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <!--Voir le temps total des employés-->
                    <span class="stat-value">Temps total : 0h 00m</span>
                    <span class="stat-label">Temps total</span>
                </div>

                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <!--Voir le nombre total des employés sélectionnés-->
                    <span class="stat-value">0/5</span>
                    <span class="stat-label">Employés total</span>
                </div>
            </div>
        </div>

        <!--Grille d'horaire-->
        <div class="schedule-grid-container">
            <div class="schedule-grid">
                <!--En-tête avec les jours de la semaine-->
                <div class="grid-header">
                    <div class="employee-header">Employés</div>
                    {% for day in week_days %}
                    <div class="day-header">
                        <div class="day-name">{{ day.jour_name }}</div>
                        <div class="day-date">{{ day.date_short }}</div>
                    </div>
                    {% endfor %}
                </div>

                <!--Corps de la grille avec les employés-->
                <div class="grid-body">
                    {% for employee in employes %}
                    <div class="employee-row" data-employee-id="{{ employee.id }}">
                        <!-- Nom de l'employé -->
                        <div class="employee-info">
                            <div class="employee-name">{{ employee.nom }}</div>
                            <div class="employee-role">{{ employee.poste }}</div>
                            <div class="employee-color" data-color="{{ employee.couleur }}"></div>
                        </div>

                        <!-- Cellules d'horaire pour chaque jour -->
                        {% for day in week_days %}
                        <div class="schedule-cell" data-employee-id="{{ employee.id }}" data-day="{{ day.jour_key }}"
                            data-date="{{ day.date_str }}">
                            <div class="time-slot">
                                <!-- Zone où l'horaire sera affiché/édité -->
                                <span class="time-display">-</span>
                                <button class="edit-time-btn" title="Modifier l'horaire">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>
    </div>
</section>

{% endblock content %}

{% block extra_js %}
<!-- Debug: Affichage des données -->
<!-- week_days premier élément: {{ week_days.0 }} -->
<!-- week_days_json: {{ week_days_json|safe }} -->

<!-- Données pour JavaScript -->
{{ week_days_json|json_script:"week-days-data" }}

<!-- Script pour la gestion des horaires -->
<script src="{% static 'RestoPlus/js/horaire.js' %}"></script>

<!-- Debug script -->
<script>
    console.log('Template loaded');
    console.log('Week days element:', document.getElementById('week-days-data'));
    if (document.getElementById('week-days-data')) {
        console.log('Week days content:', document.getElementById('week-days-data').textContent);
        try {
            const data = JSON.parse(document.getElementById('week-days-data').textContent);
            console.log('Parsed week days data:', data);
        } catch (e) {
            console.error('Error parsing week days data:', e);
        }
    }
</script>
{% endblock extra_js %}