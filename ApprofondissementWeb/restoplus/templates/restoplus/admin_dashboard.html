{%extends "restoplus/base.html" %} {%block content%}
<div class="container-fluid">
  <h1>Gestions des Rôles</h1>
  <p>Gérez les permissions de l'équipes</p>
</div>


<div class="card mb-4">
  <div class="card-header">
    <h5>Listes des utilisateurs</h5>
  </div>
  <div class="card-body">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Utilisateur</th>
          <th>Courriel</th>
          <th>Rôle actuel</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {%for user in users%}
        <tr>
          <td>{{user.get_full_name|default:user.username}}</td>
          <td>{{user.email|default:"non défini"}}</td>
          <td>
            {%if user.role%}
            <span class="badge bg-primary">{{user.role.get_name_display}}</span>
            {%else%}
            <span class="badge bg-secondary">Aucun rôle</span>
            {%endif%}
          </td>
          <td>
            {% if user.is_active %}
            <span class="badge bg-success">Actif</span>
            {%else%}
            <span class="badge bg-danger">Inactif</span>
            {%endif%}
          </td>
          <td>
            <form
              method="POST"
              action="{% url 'manage_user_role' user.id %}"
              class="d-inline"
            >
              {% csrf_token %}
              <select
                name="role_id"
                class="form-select form-select-sm"
                onchange="this.form.submit()"
              >
                <option value="">Aucun rôle</option>
                {% for role in roles%}
                    <option value="{{role.id}}"
                        {%if user.role and user.role.id == role.id%}selected{% endif %}>
                        {{role.get_name_display}}
                    </option>
                {%endfor%}
              </select>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
            <td class="text-center"> Aucun utilisateur</td>
        </tr>

        {%endfor%}
      </tbody>
    </table>
  </div>
</div>

<div class="card">
    <div class="card-header">
        <h5>Créer un Nouveau Rôle</h5>
    </div>

    <div class="card-body">
        <form method="post" action="{% url 'create_role'%}">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="name" class="form-label">Type de rôle:</label>
                        <select name="name" class="form-select">
                            <option value="">Choisir un rôle</option>
                            <option value="proprietaire">Propriétaire</option>
                            <option value="gerant">Gérant</option>
                            <option value="employe">Employé</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="description" class="form-label">Description:</label>
                        <textarea name="description" class="form-control" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Permissions:</label>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="can_manage_users" id="manage_users">
                            <label class="form-check-label" for="manage_users">
                                Gérer les utilisateurs
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="can_view_reports" id="view_reports">
                            <label class="form-check-label" for="view_reports">
                                Voirs les rapports
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="can_manage_inventory" id="manage_inventory">
                            <label class="form-check-label" for="manage_inventory">
                                Gérer l'inventaire
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="can_manage_orders" id="manage_orders">
                            <label class="form-check-label" for="manage_orders">
                                Gérer les commandes
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                Créer le Rôle
            </button>
        </form>
        <button class="text-end mb-3"> <a href="/" class="btn btn-primary"> Retour</a></button>
    </div>
</div>
{%endblock%}
